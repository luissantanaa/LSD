#! /bin/bash
#
# LSD.TOS, March 2017 (DO NOT REMOVE THIS LINE)
#
# Compile a quartus project.
#

if [ $# != 1 ]; then
  echo "Usage: compile project_dir"
  exit 1
fi

if [[ $1 == */ ]]; then
  echo "$1 has a trailing /"
  exit 1
fi

if [ ! -d $1 ]; then
  echo "$1 is not a directory"
  exit 1
fi

if [ ! -e $1/$1.qpf ]; then
  echo "$1/$1.qpf does not exist"
  exit 1
fi

# compile
set -e
cd $1
quartus_map --read_settings_files=on  --write_settings_files=off $1 -c $1
quartus_fit --read_settings_files=off --write_settings_files=off $1 -c $1
quartus_asm --read_settings_files=off --write_settings_files=off $1 -c $1
quartus_sta                                                      $1 -c $1
quartus_drc --read_settings_files=off --write_settings_files=off $1 -c $1
quartus_eda --read_settings_files=off --write_settings_files=off $1 -c $1

# save the .sof file
cd ..
if [ -d sof ]; then
  cp -f $1/output_files/$1.sof sof
fi
